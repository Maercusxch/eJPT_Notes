# 04_Vulnerability Assessment.md

## Vulnerability Assessment

### Vulnerability Scanning

Vulnerability scanning & detection is the process of scanning a target for vulnerabilities and verifying whether they can be exploited. So far, we have been able to identify and exploit misconfigurations on target systems, however, in this section, we will be exploring the process of utilizing auxiliary and exploit modules to scan and identify inherent vulnerabilities in services, operating systems, and web applications.

### Overview of Windows Vulnerabilities

**A Brief History of Windows Vulnerabilities**
- Microsoft Windows is the dominant operating system worldwide with a market share >=70% as of 2021.
- The popularity and deployment of Windows by individuals and companies makes it a prime target for attackers given the threat surface.
- Over the last 15 years, Windows has had its fair share of severe vulnerabilities, ranging from MS08-067 (Conficker) to MS17-010 (EternalBlue).
- Given the popularity of Windows, most of these vulnerabilities have publicly accessible exploit code making them relatively straightforward to exploit.

**Windows Vulnerabilities**

- Microsoft Windows has various OS versions and releases which makes the threat surface fragmented in terms of vulnerabilities. For example, vulnerabilities that exist in Windows 7 are not present in Windows 10.
- Regardless of the various versions and releases, all Windows OS’s share a likeness given the development model and philosophy:
- Windows OS’s have been developed in the C programming language, making them vulnerable to buffer overflows, arbitrary code execution, etc.
- By default, Windows is not configured to run securely and requires a proactive implementation of security practices in order to configure Windows to run securely.
- Newly discovered vulnerabilities are not immediately patched by Microsoft, and given the fragmented nature of Windows, many systems are left unpatched.
- The frequent releases of new versions of Windows is also a contributing factor to exploitation, as many companies take a substantial length of time to upgrade their systems to the latest version of Windows and opt to use older versions that may be affected by an increasing number of vulnerabilities.
- In addition to inherent vulnerabilities, Windows is also vulnerable to crossplatform vulnerabilities, for example, SQL injection attacks.
- Systems/hosts running Windows are also vulnerable to physical attacks like theft, malicious peripheral devices, etc.

**Types of Windows Vulnerabilities**
- Information disclosure: Vulnerability that allows an attacker to access confidential data.
- Buffer overflows: Caused by a programming error, allows attackers to write data to a buffer and overrun the allocated buffer, consequently writing data to allocated memory addresses.
- Remote code execution: Vulnerability that allows an attacker to remotely execute code on the target system.
- Privilege escalation - Vulnerability that allows an attacker to elevate their privileges after initial compromise.
- Denial of Service (DOS) - Vulnerability that allows an attacker to consume a system/host's resources (CPU, RAM, Network etc), consequently preventing the system from functioning normally.

### Frequently Exploited Windows Services

- Microsoft Windows has various native services and protocols that can be configured to run on a host.
- These services provide an attacker with an access vector that they can utilize to gain access to a target host.
- Having a good understanding of what these services are, how they work, and their potential vulnerabilities is a vitally important skill to have as a penetration tester.

| Protocol/Service | Ports | Purpose |
| ------------- | ------------- | ------------- |
| Microsoft IIS (Internet Information Services) | TCP ports 80/443 | Proprietary web server software developed by Microsoft that runs on Windows. |
| WebDAV (Web Distributed Authoring & Versioning) | TCP ports 80/443 | HTTP extension that allows clients to update, delete, move, and copy files on a web server. WebDAV is used to enable a web server to act as a file server. |
| SMB/CIFS (Server Message Block Protocol) | TCP port 445 | Network file-sharing protocol that is used to facilitate the sharing of files and peripherals between computers on a local network (LAN). |
| RDP (Remote Desktop Protocol) | TCP port 3389 | Proprietary GUI remote access protocol developed by Microsoft and is used to remotely authenticate and interact with a Windows system. |
| WinRM (Windows Remote Management Protocol) | TCP ports 5986/443 | Windows remote management protocol that can be used to facilitate remote access with Windows systems. |

### Vulnerability Scanning with MSF

**MSF-autopwn**
- Metasploit-autopwn is a metasploit plugin for easy exploit & vulnerability attack.
- `https://github.com/hahwul/metasploit-autopwn`

### Exploiting Microsoft WEBDAV Service

**Microsoft IIS**
IIS (Internet Information Services) is a proprietary extensible web server software developed by Microsoft for use with the Windows NT family. It can be used to host websites/web apps and provides administrators with a robust GUI for managing websites. IIS can be used to host both static and dynamic web pages developed in ASP.NET and PHP. Typically configured to run on ports 80/443.
Supported executable file extensions:.asp, .aspx, .config, .php

**WEBDAV**
WebDAV (Web-based Distributed Authoring and Versioning) is a set of extensions to the HTTP protocol which allow users to collaboratively edit and manage files on remote web servers. WebDAV essentially enables a web server to function as a file server for collaborative authoring. WebDAV runs on top Microsoft IIS on ports 80/443. In order to connect to a WebDAV server, you will need to provide legitimate credentials. This is because WebDAV implements authentication in the form of a username and password.

**WebDAV Exploitation**
The first step of the exploitation process will involve identifying whether WebDAV has been configured to run on the IIS web server. We can perform a brute-force attack on the WebDAV server in order to identify legitimate credentials that we can use for authentication. After obtaining legitimate credentials, we can authenticate with the WebDAV server and upload a malicious .asp payload that can be used to execute arbitrary commands or obtain a reverse shell on the target.

**Tools**

- davtest - Used to scan, authenticate and exploit a WebDAV server. Is Pre-installed on most offensive penetration testing distributions like Kali and Parrot OS.
- cadaver - cadaver supports file upload, download, on-screen display, in-place editing, namespace operations (move/copy), collection creation and deletion, property manipulation, and resource locking on WebDAV servers. Is Pre-installed on most offensive penetration testing distributions like Kali and Parrot OS.

